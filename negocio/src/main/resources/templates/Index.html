<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Inmobiliarias Paqui - Inicio</title>
    <link rel="stylesheet" th:href="@{/css/styleIndex.css}" />
  </head>

  <body>
    <header>
      <div class="container">
        <div class="logo" role="link" tabindex="0" aria-label="Ir a inicio"
             onclick="location.href='/'"
             onkeydown="if(event.key==='Enter'||event.key===' '){location.href='/';}">
          Inmobiliarias Paqui
        </div>
        <button class="btn-register" onclick="window.location.href='/register'">
          Iniciar sesi√≥n o registrarse
        </button>
      </div>
    </header>

    <main>
      <section class="hero">
        <h1>Encuentra tu alojamiento ideal en Espa√±a</h1>
        <p>Hoteles, apartamentos y mucho m√°s‚Ä¶ ¬°a un clic!</p>

        <div class="search-bar">
          <input type="text" placeholder="¬øA d√≥nde vas?" aria-label="Destino" />
          <input type="date" aria-label="Fecha de entrada" />
          <input type="date" aria-label="Fecha de salida" />
          <div class="people-counter" aria-label="Personas">
            <button type="button" aria-label="Quitar persona">-</button>
            <span aria-live="polite">2</span>
            <button type="button" aria-label="A√±adir persona">+</button>
          </div>
          <button class="btn-search">Buscar</button>
        </div>
      </section>

      <section class="types">
        <h2>Explora por tipo de alojamiento</h2>
        <div class="type-grid">
          <div class="type-card" data-type="apartamento" role="button" tabindex="0" aria-label="Ver apartamentos">
            üè† <span>Apartamentos</span>
          </div>
          <div class="type-card" data-type="hotel" role="button" tabindex="0" aria-label="Ver hoteles">
            üè® <span>Hoteles</span>
          </div>
        </div>
      </section>

      <section class="popular">
        <h2>Destinos populares en Espa√±a</h2>
        <div class="destinos-grid">
          <div class="destino" data-city="Madrid" role="button" tabindex="0" aria-label="Buscar en Madrid">
            <img src="https://picsum.photos/400/300?random=11" alt="Madrid"><span>Madrid</span>
          </div>
          <div class="destino" data-city="Barcelona" role="button" tabindex="0" aria-label="Buscar en Barcelona">
            <img src="https://picsum.photos/400/300?random=12" alt="Barcelona"><span>Barcelona</span>
          </div>
          <div class="destino" data-city="Valencia" role="button" tabindex="0" aria-label="Buscar en Valencia">
            <img src="https://picsum.photos/400/300?random=13" alt="Valencia"><span>Valencia</span>
          </div>
          <div class="destino" data-city="Sevilla" role="button" tabindex="0" aria-label="Buscar en Sevilla">
            <img src="https://picsum.photos/400/300?random=14" alt="Sevilla"><span>Sevilla</span>
          </div>
          <div class="destino" data-city="M√°laga" role="button" tabindex="0" aria-label="Buscar en M√°laga">
            <img src="https://picsum.photos/400/300?random=15" alt="M√°laga"><span>M√°laga</span>
          </div>
          <div class="destino" data-city="Granada" role="button" tabindex="0" aria-label="Buscar en Granada">
            <img src="https://picsum.photos/400/300?random=16" alt="Granada"><span>Granada</span>
          </div>
        </div>
      </section>
    </main>

    <footer>
      ¬© 2025 Inmobiliarias Paqui
    </footer>

    <script>
      (function () {
        // --- Utilidades ---
        function buildParams(extra = {}) {
          const [qEl, inEl, outEl] = document.querySelectorAll(".search-bar input");
          const base = {
            q: qEl.value.trim() || "",
            checkin: inEl.value || "",
            checkout: outEl.value || "",
            people: String(currentPeople)
          };
          return new URLSearchParams({ ...base, ...extra });
        }
        function go(params) {
          // Importante: usamos la ruta del controlador, no el archivo .html
          location.href = `/buscador?${params.toString()}`;
        }
        function onKeyActivate(el, handler) {
          el.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              handler();
            }
          });
        }

        // --- Contador de personas ---
        const minus = document.querySelector(".people-counter button:first-child");
        const plus  = document.querySelector(".people-counter button:last-child");
        const span  = document.querySelector(".people-counter span");
        let currentPeople = 2;
        function updatePeople(){ span.textContent = currentPeople; }
        minus.addEventListener("click", ()=>{ if(currentPeople>1){ currentPeople--; updatePeople(); }});
        plus.addEventListener("click", ()=>{ currentPeople++; updatePeople(); });
        updatePeople();

        // --- Buscar libre con barra ---
        const btn = document.querySelector(".btn-search");
        btn.addEventListener("click", () => go(buildParams()));
        document.querySelector(".search-bar").addEventListener("keydown", (e)=>{
          if (e.key === "Enter") btn.click();
        });

        // --- Explorar por tipo (Apartamentos / Hoteles) ---
        document.querySelectorAll(".type-card").forEach(card=>{
          const type = card.getAttribute("data-type");
          const handler = () => go(buildParams({ type }));
          card.addEventListener("click", handler);
          onKeyActivate(card, handler);
        });

        // --- Destinos populares (Madrid, etc.) ---
        // Limpia SIEMPRE fechas y fuerza q=<ciudad>
        document.querySelectorAll(".destino").forEach(tile=>{
          const city = tile.getAttribute("data-city");
          const handler = () => {
            const params = new URLSearchParams({
              q: city,
              checkin: "",
              checkout: "",
              people: String(currentPeople)
            });
            go(params);
          };
          tile.addEventListener("click", handler);
          onKeyActivate(tile, handler);
        });
      })();
    </script>
  </body>
</html>
